# Zwerg Configuration File
# This file defines which directories to watch and what actions to take when files change

watches:
  # Watch a source directory for Ruby files
  - path: "./src"
    recursive: true
    debounce: 300  # Wait 300ms before firing actions for the same file
    patterns:
      - "*.rb"
      - "*.yml"
    actions:
      - command: "echo 'Ruby/YAML file changed: {{file_name}}' >> ./logs/changes.log"
      - command: "rubocop {{file_path}}"

  # Watch a documentation directory
  - path: "./docs"
    recursive: true
    debounce: 1000  # Wait 1 second for documentation files
    patterns:
      - "*.md"
      - "*.txt"
    actions:
      - command: "echo 'Documentation updated: {{file_path}}'"
      - command: "cp {{file_path}} ./backup/docs/"

  # Watch configuration files in the root directory
  - path: "."
    recursive: false
    debounce: 2000  # Wait 2 seconds for config files (they might be edited multiple times)
    patterns:
      - "*.yml"
      - "*.yaml"
      - "*.json"
    actions:
      - command: "echo 'Config file changed: {{file_name}}'"
      - command: "echo 'Config changed: {{file_path}}' | mail -s 'Config Alert' admin@example.com"

  # Watch for log files and compress them when they get large
  - path: "./logs"
    recursive: false
    debounce: 5000  # Wait 5 seconds for log files (they change frequently)
    patterns:
      - "*.log"
    actions:
      - command: "if [ $(stat -c%s {{file_path}}) -gt 1048576 ]; then gzip {{file_path}}; fi"

# Each action is a shell command that will be executed when files change
#
# Configuration options:
# - path: Directory or file to watch (required)
# - recursive: Watch subdirectories (default: true)
# - debounce: Wait time in milliseconds before firing actions (default: 500ms)
# - patterns: Glob patterns to match files (optional, matches all if empty)
# - actions: Commands to execute when files change (required)

# Available variables for substitution:
# - {{file_path}}: Full path to the changed file
# - {{file_dir}}: Directory containing the file
# - {{file_name}}: Name of the file (including extension)
# - {{file_base}}: Name of the file without extension
# - {{file_ext}}: File extension (including the dot)
